function creaMapa(e){function t(){var e=new google.maps.LatLngBounds;$.each(r,function(t,a){e.extend(a.position)}),n.fitBounds(e);var t=google.maps.event.addListener(n,"idle",function(){n.getZoom()>17&&n.setZoom(17),google.maps.event.removeListener(t)})}function a(e){var t,a;return null!==typeof e&&(e.indexOf("mapa:")>-1?(t=e.split("mapa:"),a=t[1]+","+t[2]):(t=e.split("&"),$.each(t,function(e,t){t.indexOf("sll=")>-1&&(a=t.replace("sll=",""))}))),"undefined"==typeof a?-1:a}var i=[];$.each(e,function(e,t){var n=[],o=a(t.url_ubicacion),s=null===t.telefono_1?"":t.telefono_1,r=null===t.ext_1?"":" ext: "+t.ext_1,c=null===t.telefono_2?"":t.telefono_2,l=null===t.ext_2?"":" ext: "+t.ext_2,d="<h3>"+t.nombre+"</h3><h3>Dirección</h3><br /><p>"+t.calle_numero+"<br />Col. "+t.colonia+"<br />Del. "+t.delegacion+", "+t.cp+"</p><h3>Teléfonos</h3><p>"+s+r+"</p>"+"<p>"+c+l+"</p>";if(-1!=o){var u=o.split(",");n.push(d),n.push(u[0]),n.push(u[1]),i.push(n)}});var n=new google.maps.Map(document.getElementById("map"),{zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,streetViewControl:!1,panControl:!1,scrollwheel:!1,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_BOTTOM}}),o=new google.maps.InfoWindow({maxWidth:400});new google.maps.InfoWindow({maxWidth:800});var s,r=new Array;new Array;for(var c=0;c<i.length;c++)s=new google.maps.Marker({position:new google.maps.LatLng(i[c][1],i[c][2]),map:n}),r.push(s),google.maps.event.addListener(s,"click",function(e,t){return function(){o.setContent(i[t][0]),o.open(n,e)}}(s,c));t()}function busquedaTS(e,t){var a,i=$.parseJSON(e),n=[],o={};$.each(i,function(e,t){n.push(t.nombre_ts),o[t.nombre_ts]=t.id_tramite_servicio}),$('.main-search-movil input[type="search"]').autocomplete({source:n,select:function(e,i){$("#ts_movil_id").val(o[i.item.value]),a=$("#ts_movil_id").attr("value"),window.open(t+"tramites_servicios/muestraInfo/"+a,"_self")},appendTo:".main-search-movil"}),$('.main-search-footer input[type="search"]').autocomplete({source:n,select:function(e,i){$("#ts_footer_id").val(o[i.item.value]),a=$("#ts_footer_id").attr("value"),window.open(t+"tramites_servicios/muestraInfo/"+a,"_self")},appendTo:".main-search-footer"}),$('.main-search-home input[type="search"]').autocomplete({source:n,select:function(e,i){$("#ts_home_id").val(o[i.item.value]),a=$("#ts_home_id").attr("value"),window.open(t+"tramites_servicios/muestraInfo/"+a,"_self")},appendTo:".main-search-home"}),$(".main-search-movil button").on("click",function(e){e.preventDefault(),a=$("#ts_movil_id").val(),"undefined"!=typeof a&&window.open(t+"tramites_servicios/muestraInfo/"+a,"_self")}),$(".main-search-header button").on("click",function(e){e.preventDefault(),a=$("#ts_id").val(),"undefined"!=typeof a&&window.open(t+"tramites_servicios/muestraInfo/"+a,"_self")}),$(".main-search-home button").on("click",function(e){e.preventDefault(),a=$("#ts_id").val(),"undefined"!=typeof a&&window.open(t+"tramites_servicios/muestraInfo/"+a,"_self")})}function agregarTS(e,t,a){var i=$.parseJSON(e),n=[],o={};$.each(i,function(e,t){a.indexOf(t.id_tramite_servicio)<0&&(n.push(t.nombre_ts),o[t.nombre_ts]=t.id_tramite_servicio)}),$('.main-search-cms input[type="search"]').autocomplete({source:n,select:function(e,a){$("#ts_cms_id").val(o[a.item.value]);var i=$("#ts_cms_id").attr("value"),n=a.item.value;agregarTSSolicitado(i,n,t),i=$("#ts_cms_id").val("x")},appendTo:".main-search-cms"}),$(".main-search button").on("click",function(e){e.preventDefault();var a=$("#ts_cms_id").val(),i=$('input[type="search"]').val();return"x"==a?($(".error").text('No existe el trámite o servicio "'+i+'."'),$(".error").removeClass("hide"),0):(agregarTSSolicitado(a,i,t),a=$("#ts_cms_id").val("x"),void 0)})}function agregarTSSolicitado(e,t,a){var i={};i.id_ts=e,console.log(e),$.post(a+"gestor_contenidos/agregar_ts_solicitado",i,function(a){var i=$.parseJSON(a);if($(".success, .error").addClass("hide"),"success"==i.estatus){$(".success").text(i.msg),$(".success").removeClass("hide");var n='<div class="fila clearfix highlight"> 								<p class="columna xmall-10">'+t+'</p> 								<a href="" data-ts="'+e+'" class="text-center block columna xmall-2">Eliminar</a> 							</div>';$(n).insertAfter(".tabla-ts .header"),setTimeout(function(){$(".fila").removeClass("highlight")},700)}else $(".error").text(i.msg),$(".error").removeClass("hide")})}function eliminarTSSolicitado(e){$(".fila a").on("click",function(t){t.preventDefault();var a=$(this).data("ts"),i={};i.id_ts=a,$.post(e+"gestor_contenidos/eliminar_ts_solicitado",i,function(e){var t=$.parseJSON(e);$(".success, .error").addClass("hide"),$(".success").text(t.msg),$(".success").removeClass("hide")}),$(this).parent().remove()})}function agregarTSReportes(e,t){var a=$.parseJSON(e),i=[],n={};$.each(a,function(e,t){i.push(t.nombre_ts),n[t.nombre_ts]=t.id_tramite_servicio}),$('.main-search-reportes input[type="search"]').autocomplete({source:i,select:function(e,a){$("#ts_cms_id").val(n[a.item.value]);var i=$("#ts_cms_id").attr("value"),o=a.item.value;muestraReporteTS(i,o,t)},appendTo:".main-search-reportes"}),$(".main-search button").on("click",function(e){e.preventDefault();var a=$("#ts_cms_id").val(),i=$('input[type="search"]').val();muestraReporteTS(a,i,t)})}function muestraReporteTS(e,t,a){function i(){$(".visitas-mensuales").addClass("hide"),$(".feedback").addClass("hide"),$(".fila").not(".header").remove(),$(".feedback .tabla").addClass("hide"),$(".feedback #promedio").addClass("hide"),$(".visitas-mensuales canvas").remove()}function n(e){var t;switch(e){case"01":t="Enero";break;case"02":t="Febrero";break;case"03":t="Marzo";break;case"04":t="Abril";break;case"05":t="Mayo";break;case"06":t="Junio";break;case"07":t="Julio";break;case"08":t="Agosto";break;case"09":t="Septiembre";break;case"10":t="Octubre";break;case"11":t="Noviembre";break;case"12":t="Diciembre"}return t}var o={};o.id_ts=e,i(),$.post(a+"gestor_contenidos/muestra_reporte_ts",o,function(e){var t,a,i=$.parseJSON(e);$.each(i,function(e,i){"visitas"==e?t=i:a=i});var o=[],s=[],r=0;$.each(t,function(e,t){fecha_ar=t.fecha.split("-"),ano=fecha_ar[0],mes=n(fecha_ar[1]),o.push(mes+" "+ano),s.push(t.num_visitas),r+=parseInt(t.num_visitas)});var c,l=0,d=0;$.each(a,function(e,t){var a="t"==t.ayuda?"Si":"No",i='<div class="fila clearfix"> 								<div class="columna xmall-5"> 									'+t.comentarios+'								</div> 								<div class="columna xmall-2 text-center"> 									'+t.calificacion+'								</div> 								<div class="columna xmall-2 text-center"> 									'+t.servicio+'								</div> 								<div class="columna xmall-3 text-center"> 									'+a+"								</div> 							</div>";$(i).appendTo(".feedback .tabla"),l+=1,d+=parseInt(t.calificacion)}),c=d/l,c=c.toFixed(2),0!==r?($(".visitas-mensuales span").text(r),$(".visitas-mensuales").removeClass("hide"),$(".visitas-mensuales").append('<canvas id="chartVisitasMensuales"></canvas>'),visitasMensuales(s,o)):($(".visitas-mensuales").removeClass("hide"),$(".visitas-mensuales span").text("0")),0!==l?($(".feedback #comentarios span").text(l),$(".feedback #promedio span").text(c),$(".feedback #promedio").removeClass("hide"),$(".feedback .tabla").removeClass("hide"),$(".feedback").removeClass("hide")):($(".feedback #comentarios span").text("0"),$(".feedback #promedio span").text("-"),$(".feedback").removeClass("hide"))})}function setLimitDate(e){$(e).each(function(){var e=$(this).find('input[name="fecha_inicial"]'),t=$(this).find('input[name="fecha_final"]');e.datepicker({minDate:"0",dateFormat:"yy-mm-dd"}),e.on("change",function(){var e=new Date($(this).val()),a=new Date(e);a.setDate(a.getDate()+2),t.datepicker({minDate:a,dateFormat:"yy-mm-dd"})})})}function toggleUrlAviso(){$('.crea-aviso input[name="link_aviso"]').change(function(){$(this).is(":checked")?($(".url_aviso").removeClass("hide"),$(".url_aviso input").addClass("required"),$(".url_aviso input").val(""),$(".url_aviso input").focus()):($(".url_aviso").addClass("hide"),$(".url_aviso input").removeClass("required"),$(".url_aviso input").val("-"))})}function toggleUrlAnuncio(){$('.crea-anuncio input[name="link_anuncio"]').change(function(){$(this).is(":checked")?($(".url_anuncio").removeClass("hide"),$(".url_anuncio input").addClass("required"),$(".url_anuncio input").val(""),$(".url_anuncio input").focus()):($(".url_anuncio").addClass("hide"),$(".url_anuncio input").removeClass("required"),$(".url_anuncio input").val("-"))})}function toggleSubirImagen(){$('input[name="subir_img"]').change(function(){$(this).is(":checked")?($(".cargar_img").removeClass("hide"),$(".img_actual").addClass("hide")):($(".cargar_img").addClass("hide"),$(".img_actual").removeClass("hide"))})}function votoPregunta(e){$(".j-pregunta-container a").on("click",function(t){t.preventDefault();var a={};a.pregunta=$(this).data("pregunta"),a.respuesta=$(this).data("respuesta"),$.post(e+"inicio/set_voto",a,function(){$(".j-pregunta-container").empty(),$(".j-pregunta-container").html('<h2 class="text-center highlight">¡Gracias!</h2><h4 class="text-center">Tu opinión es muy importante para nosotros.</h4>')})})}function scrollHeader(e){var t=$(window).scrollTop();if($(e).length>0){var a=$(e).offset().top,i=$(e).height(),n=a+i;t>n?$(".when-scrolled").addClass("after-scrolled"):$(".when-scrolled").removeClass("after-scrolled")}}function numRespuestasSiNo(e,t){var a={labels:["Si","No"],datasets:[{label:"Respuestas",fillColor:"rgba(236, 35, 131, 0.5)",strokeColor:"rgba(236, 35, 131, 1)",pointColor:"rgba(162, 43, 56, 1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(162, 43, 56, 1)",data:[e,t]}]},i=$("#chartRespuestas").get(0).getContext("2d");new Chart(i).Bar(a)}function porcentajeRespuestasSiNo(e,t){var a=[{value:parseFloat(e),color:"rgba(236, 35, 131, 0.2)",highlight:"rgba(236, 35, 131, 0.3)",label:"Si(%)"},{value:parseFloat(t),color:"rgba(236, 35, 131, 0.7)",highlight:"rgba(236, 35, 131, 0.8)",label:"No(%)"}],i=$("#donaRespuestas").get(0).getContext("2d");new Chart(i).Doughnut(a)}function visitasMensuales(e,t){var a={labels:t,datasets:[{label:"Respuestas",fillColor:"rgba(236, 35, 131, 0.5)",strokeColor:"rgba(236, 35, 131, 1)",pointColor:"rgba(162, 43, 56, 1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(162, 43, 56, 1)",data:e}]},i=$("#chartVisitasMensuales").get(0).getContext("2d");new Chart(i).Bar(a)}function imprimirInfoTramite(){$(".j-imprimir").on("click",function(e){e.preventDefault(),window.print()})}function muestraAreaAtencionPorDelegacion(){$('select[name="delegacion"]').change(function(){var e=$('input[name="id_tramite_servicio"]').val(),t=$(this).find("option:selected").val(),a=localStorage.getItem("url_ws")+"/area_atencion_tramite_delegacion/del/"+t.trim()+"/id/"+e+"/format/json";$(".j_area_atencion").addClass("hide"),$(".j_area_atencion .fila").not(".header").remove(),$(".map-wrapper").remove(),"Seleccionar"!==t&&$.get(a,function(e){$(".j_area_atencion").removeClass("hide"),$(".j_area_atencion").after('<div class="[ map-wrapper ] [ margin-bottom ]"><div id="map"></div></div>'),creaMapaAreaAtencion(e)})})}function creaMapaAreaAtencion(e){return"undefined"==typeof e?($(".j_area_atencion").empty(),$(".j_area_atencion").append("<p>Por el momento no existen áreas de atención asociadas a ésta delegación.</p>"),0):($(".header").show(),$.each(e,function(e,t){var a=t.telefono_1,i=t.telefono_2,n="",o="";null===a&&(a="-"),null===i&&(i=""),null!==t.ext_1&&(n="ext. "+t.ext_1),null!==t.ext_2&&(o="ext. "+t.ext_2);var s=' 			<div class="fila clearfix"> 				<div class="[ columna xmall-6 medium-3 ]">'+t.nombre+'</div> 				<div class="[ columna xmall-6 medium-4 ]"> 					'+t.calle_numero+", Col. "+t.colonia+", Del. "+t.delegacion+", "+t.cp+'				</div> <div class="[ xmall-clear ] [ margin-bottom-small ]"></div>				<div class="[ columna xmall-6 medium-3 ] [ j-horario ]" data-area="'+t.id_area_atencion_ts+e+'"> 				</div> 				<div class="[ columna xmall-6 medium-2 ]"> 					'+a+" "+n+"<br /> "+"					"+i+" "+o+"				</div> 			</div>";$(".j_area_atencion").append(s);var r=getHorarioAreaAtencion(t.id_area_atencion_ts,e);console.log(r)}),creaMapa(e),void 0)}function getHorarioAreaAtencion(e,t){var a=localStorage.getItem("url_ws")+"/horario_area_atencion/id/"+e+"/format/json";console.log(a),$.get(a,function(t){var a=0;console.log(t),$.each(t,function(t,i){var n=$("div").find('[data-area="'+e+'"]');if(a!=i.dias){a=i.dias;var o=getDiasAreaAtencion(i.dias);n.append("<strong>"+o+"</strong><br />"+i.hora_inicio+" - "+i.hora_fin+"<br />")}else n.append(i.hora_inicio+" - "+i.hora_fin+"<br /><br />")})}).fail(function(){var a=$("div").find('[data-area="'+e+t+'"]');a.append("<strong>No hay horarios de atención disponible.</strong><br />")})}function getDiasAreaAtencion(e){var t=e.split("_");if(1==t.length)return getDia(t[0]);var a="";return $.each(t,function(e,i){return 0==e?(a=getDia(i),!0):e+1==t.length?(a=a+" y "+getDia(i),!0):(a=a+", "+getDia(i),void 0)}),a}function getDia(e){switch(e){case"lu":return"Lunes";case"ma":return"Martes";case"mi":return"Miércoles";case"ju":return"Jueves";case"vi":return"Viernes";case"sa":return"Sábado";case"do":return"Domingo"}}function agregarFeedback(){$('.feedback [type="submit"]').on("click",function(e){e.preventDefault();var t=$('textarea[name="comentarios"').val();if(""==$.trim(t))return alert("El campo de comentarios no puede quedar vacío."),void 0;var a=$(".feedback").serialize(),i=localStorage.getItem("base_url")+"tramites_servicios/agregar_feedback";$.post(i,a,function(){$(".feedback").remove(),$(".danos-tu-opinion").append("<h3>Gracias por tus comentarios. Tu opinión es muy importante para nosotros.</h3>")})})}!function(e){"use strict";function t(e){e.slideToggle("fast")}function a(e){e.slideUp("fast")}function i(t){var a=t.data("tab");e(".tabs-header a").removeClass("active"),t.addClass("active"),e(".tab-content > div").removeClass("active"),e(".tab-content .tab-"+a).addClass("active")}function n(t){var a=t.parent(".acordeon-item").find("ul"),i=t.closest(".acordeon-item").find(".drop");a.hasClass("hide")?(e(".acordeon-item").find("ul").addClass("hide"),a.removeClass("hide"),e(".acordeon-item").find(".drop").removeClass("up"),i.addClass("up")):(e(".acordeon-item").find("ul").addClass("hide"),i.removeClass("up"))}function o(t,a){e.each(t,function(){var t=e(this).find(a).length;e(this).find("h2").find("span").html("("+t+" trámites)")})}function s(){u()}function r(){m()}function c(t){var a=t.parent().parent();a.fadeOut("fast",function(){e(this).addClass("hide")})}function l(){e(".overlay-wrapper").fadeIn("fast",function(){e(this).removeClass("hide")})}function d(t){var a=t.parent();a.fadeOut("fast",function(){e(this).addClass("hide")})}function u(){if(e(".masonry-container").length>0){var t=e(".masonry-container");new Masonry(t[0],{itemSelector:".item"})}}function m(){if(e(".masonry-container").length>0){var t=e(".masonry-container"),a=new Masonry(t[0]);a.destroy()}}function p(t){var a=t.data("seccion"),i=e("article[data-seccion='"+a+"']").offset().top;i-=100,e("html, body").animate({scrollTop:i},400)}function f(){e("html, body").animate({scrollTop:0},400)}function h(t){e(t).marquee({duration:12e3,pauseOnHover:!0})}e(function(){e(".mensaje p").removeClass("hide"),h(".mensaje p"),e(".masonry-container").length>0&&u(),o(e(".letra"),"li"),e(".example-f").barrating({showSelectedRating:!1,initialRating:5}),e(".tabs-header a").on("click",function(t){t.preventDefault(),i(e(this))}),e("body").on("click",".modal .cerrar",function(){c(e(this))}),e("body").on("click",".js-overlay-opener",function(){l(e(this))}),e("body").on("click",".overlay-wrapper .cerrar",function(){d(e(this))}),e("body").on("click",".scrollTo",function(){p(e(this))}),e("body").on("click",".back-to-top",function(){f()}),e(".menu").on("click",function(){a(e("header .main-search")),t(e("nav"))}),e(".search").on("click",function(){a(e("nav")),t(e("header .main-search"))}),mediaCheck({media:"(min-width: 64.063em)",entry:function(){},exit:function(){},both:function(){}}),mediaCheck({media:"(min-width: 40.063em)",entry:function(){s()},exit:function(){r()},both:function(){}}),e("body").on("click",".acordeon-item > .boton-acordeon",function(t){t.preventDefault(),n(e(this))}),e(".js-login-form").validate(),e(".js-validate-aviso").validate({rules:{aviso:{maxlength:140},vigencia:{date:!0}}}),e(".js-validate-pregunta").validate({rules:{vigencia:{date:!0}}}),e(".js-validate-anuncio").validate({rules:{vigencia:{date:!0}}}),e(".feedback").validate({rules:{comentarios:{maxlength:1e3}}}),e(".js-validate-aviso").validate({rules:{aviso:{maxlength:140},vigencia:{date:!0}}}),e.datepicker.regional.es={closeText:"Cerrar",prevText:"<",nextText:">",currentText:"Hoy",monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthNamesShort:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],dayNames:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],dayNamesShort:["Dom","Lun","Mar","Mié","Juv","Vie","Sáb"],dayNamesMin:["Do","Lu","Ma","Mi","Ju","Vi","Sá"],weekHeader:"Sm",dateFormat:"dd/mm/yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},e.datepicker.setDefaults(e.datepicker.regional.es)})}(jQuery);